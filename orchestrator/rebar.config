%% 1. Hex Repositories
{hex, [
  {repos, [
    #{name => <<"hexpm">>, api_url => <<"https://hex.pm/api">>},
    #{name => <<"rabbitmq">>, api_url => <<"https://packagecloud.io/rabbitmq/erlang/hexpm/api">>}
  ]}
]}.

%% 2. Dependencies
{deps, [
  {amqp_client, "4.0.3"},
  {rabbit_common, "4.0.3"},
  {cowboy, "2.11.0"},
  {cowlib, "2.12.1"},
  {ranch, "1.8.0"},
  {jsx, "~> 3.0"},
  {lager, "3.9.2"}
]}.

%% 3. Compiler Options
{erl_opts, [
  debug_info,
  warn_unused_import,
  warn_shadow_vars,
  warn_unused_vars,
  warn_unused_function,
  warn_bif_clash,
  warn_unused_record,
  warn_deprecated_function,
  warn_obsolete_guard,
  warn_untyped_record,
  warn_export_vars,
  warn_exported_vars,
  warn_untyped_function,
  {parse_transform, lager_transform}
]}.

%% 4. Plugins
{plugins, []}.

{lager_extra_sinks, []}.

%% 5. Profiles
{profiles, [
  {prod, [
    {erl_opts, [
      {d, 'PRODUCTION'}
    ]},
    {relx, [{dev_mode, false}, {include_erts, true}]}
  ]},
  {dev, [
    {erl_opts, [
      {d, 'DEVELOPMENT'},
      {d, 'DEBUG'}
    ]}
  ]}
]}.

%% 6. Release Configuration
{relx, [
  {release, {distriqueue, "1.0.0"}, [
    distriqueue,
    sasl,
    lager %% Start logger with the app
  ]},
  {sys_config, "./config/sys.config"},
  {vm_args, "./config/vm.args"},
  {dev_mode, false},
  {include_erts, false},
  {extended_start_script, true}
]}.

{shell, [
  {apps, [distriqueue]}
]}.

%% 7. Overrides
%% Forces Rebar3 to ignore strict warnings in RabbitMQ's old code
{overrides, [
  {del, rabbit_common, [{erl_opts, [warnings_as_errors]}]},
  {del, amqp_client, [{erl_opts, [warnings_as_errors]}]}
]}.