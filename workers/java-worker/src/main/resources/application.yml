spring:
  application:
    name: distriqueue-java-worker

  # RabbitMQ Configuration
  rabbitmq:
    addresses: ${RABBITMQ_ADDRESSES:10.2.1.11:5672,10.2.1.12:5672}
    username: ${RABBITMQ_USERNAME:admin}
    password: ${RABBITMQ_PASSWORD:admin}
    connection-timeout: 5s
    virtual-host: /

    listener:
      simple:
        concurrency: 3
        max-concurrency: 10
        prefetch: 1 # Critical for fair dispatch!
        default-requeue-rejected: false

  # Fixed Jackson Configuration for Jackson 3.0
  jackson:
    time-zone: UTC
    # Note: write-dates-as-timestamps removed as it's not supported in this version's enum

# Worker Configuration
distriqueue:
  worker:
    id: ${WORKER_ID:java-worker-${random.uuid}}
    type: ${WORKER_TYPE:java}
    capacity: ${WORKER_CAPACITY:15}

    # Fixed: Comma-separated string for @Value injection
    queues: ${QUEUES:job.high,job.medium,job.low}

    job:
      max-retries: 3
      concurrency: 5

    health:
      heartbeat-interval: 10000

    status:
      # Fixed: Corrected URL syntax and removed /v1 to match your Erlang router
      update-url: ${STATUS_UPDATE_URL:http://10.2.1.11:8081/api/jobs/status}
      retry-attempts: 3
      retry-delay: 1000

  erlang:
    # Matches your actual Erlang node names
    nodes: orchestrator@10.2.1.11,orchestrator@10.2.1.12

# Management & Logging
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus

logging:
  level:
    it.unipi.javaworker: DEBUG
    org.springframework.amqp: INFO
