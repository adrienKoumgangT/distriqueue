\chapter{System Architecture}\label{ch:system-architecture}


\section{High-Level Architecture and Justification}\label{sec:high-level-architecture}

To fulfill the course requirements regarding models, paradigms, and middleware, the system adopts a Message-Oriented Middleware (MOM) paradigm integrated with an Actor-model orchestrator.
\begin{itemize}
    \item \textbf{Erlang/OTP}: Chosen for its native implementation of the Actor model, asynchronous message passing, and "let it crash" philosophy, making it ideal for distributed fault-tolerant coordination.
    \item \textbf{RabbitMQ}: Chosen to decouple the HTTP ingestion layer from the execution layer.
    It handles the "communication" requirement by providing durable, asynchronous message queues with priority support.
    \item \textbf{Java/Spring Boot}: Chosen for the API Gateway to satisfy the "Advanced Java topics for enterprise applications" requirement, leveraging robust REST controllers and Server-Sent Events (SSE).
\end{itemize}

\section{Data Flow}\label{sec:data-flow}

\textbf{Job Submission Flow:}
\begin{enumerate}
    \item Client submits a job via REST API to the Java Spring Boot API Gateway.
    \item The Gateway persists the job and publishes it to RabbitMQ (\texttt{jobs.exchange}) with an AMQP priority (High/Medium/Low).
    \item The Erlang Orchestrator consumes the job from RabbitMQ.
    \item The Orchestrator's Router dynamically discovers the least-loaded, capable polyglot worker and assigns the task.
    \item The Worker (Python/Java) executes the job and sends a status update via HTTP to the Erlang Orchestrator.
    \item Erlang updates its internal Mnesia/Map state, replicates it via CRDTs, and broadcasts the status back to the Gateway via RabbitMQ (\texttt{status.exchange}).
    \item The API Gateway receives the AMQP update and notifies clients via SSE.
\end{enumerate}

\textbf{Failure Recovery Flow:}
\begin{enumerate}
    \item Leader orchestrator node fails.
    [cite_start]\item Remaining nodes detect failure via heartbeat timeout[cite: 71, 72].
    \item Raft consensus elects a new leader.
    \item New leader resumes job processing and re-registers connected workers.
\end{enumerate}

\section{Component Responsibilities}\label{sec:component-responsabilities}

\begin{itemize}
    \item \textbf{Orchestrator (Erlang/OTP)}: Leader election, job registry, dynamic worker routing, load balancing, health monitoring[cite: 73].
    \item \textbf{API Gateway (Java/Spring)}: REST API, SSE streaming, Jackson JSON serialization.
    \item \textbf{Message Broker (RabbitMQ)}: Priority queuing, AMQP routing.
    \item \textbf{Workers (Python, Java)}: Job execution (calculation, transformation, validation)[cite: 73].
\end{itemize}
